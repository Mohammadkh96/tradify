üóÑÔ∏è TRADIFY ‚Äî DATABASE DESIGN & PERSISTENCE (DETAILED SPEC)

Design principles

Relational-first (PostgreSQL or equivalent)

UUID primary keys everywhere

Soft deletes where applicable

Immutable trading data (no edits after insert)

Auditability and traceability by default

1Ô∏è‚É£ USER & ACCOUNT TABLES
1.1 users (Auth + Identity)

Purpose

Core identity & authorization table

Columns

id UUID PK

email VARCHAR(255), UNIQUE, NOT NULL

password_hash TEXT, NOT NULL

email_verified BOOLEAN DEFAULT false

role ENUM(user, admin)

status ENUM(active, suspended, deleted)

created_at TIMESTAMP WITH TIME ZONE

updated_at TIMESTAMP WITH TIME ZONE

last_login_at TIMESTAMP WITH TIME ZONE NULL

Rules

Email stored lowercase

Soft delete only (status)

No cascade deletes

1.2 subscriptions

Purpose

Track subscription state independently of PSP

Columns

id UUID PK

user_id UUID FK ‚Üí users(id)

psp_provider ENUM(paddle, stripe, other)

psp_customer_id TEXT

psp_subscription_id TEXT

plan_code TEXT

status ENUM(active, trialing, past_due, canceled, expired)

current_period_start TIMESTAMP

current_period_end TIMESTAMP

created_at TIMESTAMP

updated_at TIMESTAMP

Rules

One active subscription per user

PSP is source of truth for billing

Platform enforces access

1.3 account_settings

Purpose

User-level preferences

Columns

id UUID PK

user_id UUID FK

theme ENUM(light, dark)

timezone TEXT

language TEXT

created_at TIMESTAMP

updated_at TIMESTAMP

Rules

One row per user

Defaults applied on user creation

2Ô∏è‚É£ TRADING DATA
2.1 trades (RAW, IMMUTABLE)

Purpose

Store raw MT5 trade data

Columns

id UUID PK

user_id UUID FK

mt5_account_id TEXT

ticket_id TEXT

symbol TEXT

direction ENUM(buy, sell)

volume DECIMAL

open_price DECIMAL

close_price DECIMAL

open_time TIMESTAMP

close_time TIMESTAMP

profit DECIMAL

commission DECIMAL

swap DECIMAL

created_at TIMESTAMP

Rules

Trades are append-only

No updates after insert

Deduplicate on (mt5_account_id, ticket_id)

2.2 performance_aggregates

Purpose

Precomputed metrics for performance views

Columns

id UUID PK

user_id UUID FK

period_type ENUM(daily, weekly, monthly, all_time)

period_start DATE

period_end DATE

total_trades INTEGER

win_rate DECIMAL

net_profit DECIMAL

max_drawdown DECIMAL

risk_reward_avg DECIMAL

created_at TIMESTAMP

Rules

Recomputed asynchronously

Never calculated on frontend

2.3 session_performance

Purpose

Track performance by trading session

Columns

id UUID PK

user_id UUID FK

session ENUM(asia, london, new_york)

total_trades INTEGER

win_rate DECIMAL

net_profit DECIMAL

created_at TIMESTAMP

2.4 strategy_tags

Purpose

User-defined trade categorization

Columns

id UUID PK

user_id UUID FK

name TEXT

created_at TIMESTAMP

Join table

trade_strategy_tags

trade_id

strategy_tag_id

3Ô∏è‚É£ AI & ANALYTICS
3.1 behavioral_flags

Purpose

Store detected behavioral issues

Columns

id UUID PK

user_id UUID FK

flag_type ENUM(
overtrading,
risk_spike,
revenge_trading,
discipline_break
)

severity ENUM(low, medium, high)

context JSONB

created_at TIMESTAMP

Rules

Read-only

Generated by AI or rules engine

3.2 ai_insights

Purpose

Persist AI-generated insights

Columns

id UUID PK

user_id UUID FK

insight_type TEXT

summary TEXT

confidence_score DECIMAL

source_data_hash TEXT

created_at TIMESTAMP

Rules

Immutable

Used for audit & history

3.3 sentiment_narratives

Purpose

Store market sentiment context

Columns

id UUID PK

asset TEXT

topic TEXT

sentiment_score DECIMAL

volume_score DECIMAL

source ENUM(news, social, combined)

created_at TIMESTAMP

Rules

Global data (not user-specific)

Time-series indexed

4Ô∏è‚É£ SYSTEM TABLES
4.1 audit_logs

Purpose

Track sensitive actions

Columns

id UUID PK

user_id UUID NULL

action TEXT

entity_type TEXT

entity_id UUID NULL

ip_address TEXT

created_at TIMESTAMP

Examples

Login

Subscription change

Settings update

4.2 error_logs

Purpose

Store system errors

Columns

id UUID PK

error_code TEXT

message TEXT

stack_trace TEXT

context JSONB

created_at TIMESTAMP

Rules

No PII in stack traces

Retention policy enforced

5Ô∏è‚É£ INDEXING & PERFORMANCE RULES

Index all FK columns

Index:

user_id

created_at

ticket_id

Use partial indexes for active subscriptions

6Ô∏è‚É£ NON-NEGOTIABLE DATABASE RULES

No cascading deletes

No hard deletes on core data

No business logic in DB triggers

No AI logic inside queries

All writes validated at API layer